<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/svg+xml" href="/vite.svg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <title>Recipe Keeper - TikTok Recipe Manager</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
        :root {
            --cream: #FAF6F1;
            --warm-beige: #F5EDE4;
            --terracotta: #C4977D;
            --sage: #9CAF88;
            --brown: #6B5B4F;
            --dark-brown: #4A4039;
            --soft-white: #FFFEFB;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--cream);
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23C4977D' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        
        .font-display {
            font-family: 'Playfair Display', serif;
        }
        
        .tag-chip {
            transition: all 0.2s ease;
        }
        
        .tag-chip:hover {
            transform: translateY(-1px);
        }
        
        .recipe-card {
            transition: all 0.3s ease;
        }
        
        .recipe-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(107, 91, 79, 0.15);
        }
        
        .modal-overlay {
            backdrop-filter: blur(4px);
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--terracotta);
            box-shadow: 0 0 0 3px rgba(196, 151, 125, 0.2);
        }
        
        .thumbnail-placeholder {
            background: linear-gradient(135deg, var(--warm-beige) 0%, var(--cream) 100%);
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--cream);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--terracotta);
            border-radius: 4px;
        }
        
        .loading-spinner {
            border: 3px solid var(--warm-beige);
            border-top: 3px solid var(--terracotta);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="sticky top-0 z-40 bg-[#FAF6F1]/95 backdrop-blur-sm border-b border-[#C4977D]/20">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-[#C4977D] rounded-full flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                    </div>
                    <h1 class="font-display text-2xl font-bold text-[#4A4039]">Recipe Keeper</h1>
                </div>
                
                <!-- Search Bar -->
                <div class="flex-1 max-w-xl">
                    <div class="relative">
                        <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-[#6B5B4F]/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        <input 
                            type="text" 
                            id="searchInput"
                            placeholder="Search recipes by title, tags, or description..."
                            class="w-full pl-10 pr-4 py-2.5 bg-white border border-[#C4977D]/30 rounded-xl text-[#4A4039] placeholder-[#6B5B4F]/50"
                        >
                    </div>
                </div>
                
                <!-- Add Recipe Button -->
                <button 
                    onclick="openAddModal()"
                    class="flex items-center gap-2 px-5 py-2.5 bg-[#C4977D] hover:bg-[#B38A70] text-white rounded-xl transition-colors font-medium"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                    Add Recipe
                </button>
                
                <!-- AI Settings Button -->
                <button 
                    onclick="openApiKeyModal()"
                    class="flex items-center gap-2 px-3 py-2.5 bg-[#F5EDE4] hover:bg-[#E8DDD2] text-[#6B5B4F] rounded-xl transition-colors"
                    title="AI Settings"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                    </svg>
                    <span id="aiIndicator" class="w-2 h-2 rounded-full bg-gray-300"></span>
                </button>
            </div>
        </div>
    </header>

    <!-- View Toggle & Filter Section -->
    <section class="max-w-7xl mx-auto px-4 py-4">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4">
            <!-- View Toggle -->
            <div class="flex items-center gap-2 bg-[#F5EDE4] p-1 rounded-xl">
                <button 
                    onclick="setView('gallery')"
                    id="galleryViewBtn"
                    class="flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium bg-white text-[#4A4039] shadow-sm transition-all"
                >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
                    </svg>
                    Gallery
                </button>
                <button 
                    onclick="setView('timeline')"
                    id="timelineViewBtn"
                    class="flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium text-[#6B5B4F] hover:bg-white/50 transition-all"
                >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    Timeline
                    <span id="upcomingCount" class="hidden px-1.5 py-0.5 bg-[#C4977D] text-white text-xs rounded-full">0</span>
                </button>
            </div>
            
            <!-- Tag Filters -->
            <div class="flex items-center gap-3 flex-wrap" id="tagFilterSection">
                <span class="text-sm font-medium text-[#6B5B4F]">Filter by:</span>
                <button 
                    onclick="filterByTag(null)"
                    class="tag-chip px-3 py-1.5 rounded-full text-sm font-medium bg-[#9CAF88] text-white active-filter"
                    id="allTagsBtn"
                >
                    All Recipes
                </button>
                <div id="tagFilters" class="flex flex-wrap gap-2">
                    <!-- Dynamic tags will be inserted here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Recipe Gallery -->
    <main class="max-w-7xl mx-auto px-4 py-6">
        <!-- Gallery View -->
        <div id="galleryView">
            <div id="recipeGallery" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Recipe cards will be inserted here -->
            </div>
        </div>
        
        <!-- Timeline View -->
        <div id="timelineView" class="hidden">
            <div id="timelineContent" class="max-w-3xl mx-auto">
                <!-- Timeline content will be inserted here -->
            </div>
            
            <!-- No Planned Recipes State -->
            <div id="noPlannedState" class="hidden text-center py-20">
                <div class="w-24 h-24 mx-auto mb-6 bg-[#F5EDE4] rounded-full flex items-center justify-center">
                    <svg class="w-12 h-12 text-[#C4977D]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                </div>
                <h3 class="font-display text-2xl text-[#4A4039] mb-2">No planned recipes</h3>
                <p class="text-[#6B5B4F] mb-6">Set a "Plan to Cook" date on your recipes to see them here!</p>
            </div>
        </div>
        
        <!-- Empty State -->
        <div id="emptyState" class="hidden text-center py-20">
            <div class="w-24 h-24 mx-auto mb-6 bg-[#F5EDE4] rounded-full flex items-center justify-center">
                <svg class="w-12 h-12 text-[#C4977D]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                </svg>
            </div>
            <h3 class="font-display text-2xl text-[#4A4039] mb-2">No recipes yet</h3>
            <p class="text-[#6B5B4F] mb-6">Start building your collection by adding your first TikTok recipe!</p>
            <button 
                onclick="openAddModal()"
                class="inline-flex items-center gap-2 px-6 py-3 bg-[#C4977D] hover:bg-[#B38A70] text-white rounded-xl transition-colors font-medium"
            >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Add Your First Recipe
            </button>
        </div>
        
        <!-- No Results State -->
        <div id="noResultsState" class="hidden text-center py-20">
            <div class="w-24 h-24 mx-auto mb-6 bg-[#F5EDE4] rounded-full flex items-center justify-center">
                <svg class="w-12 h-12 text-[#C4977D]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
            </div>
            <h3 class="font-display text-2xl text-[#4A4039] mb-2">No recipes found</h3>
            <p class="text-[#6B5B4F]">Try adjusting your search or filters</p>
        </div>
    </main>

    <!-- API Key Modal -->
    <div id="apiKeyModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0 bg-[#4A4039]/50" onclick="closeApiKeyModal()"></div>
        <div class="absolute inset-x-4 top-1/2 -translate-y-1/2 md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-md bg-[#FFFEFB] rounded-2xl shadow-2xl overflow-hidden">
            <div class="flex items-center justify-between px-6 py-4 border-b border-[#C4977D]/20">
                <h2 class="font-display text-xl font-semibold text-[#4A4039]">AI Settings</h2>
                <button onclick="closeApiKeyModal()" class="p-2 hover:bg-[#F5EDE4] rounded-lg transition-colors">
                    <svg class="w-5 h-5 text-[#6B5B4F]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-[#4A4039] mb-2">Groq API Key</label>
                    <input 
                        type="password" 
                        id="groqApiKeyInput"
                        placeholder="gsk_..."
                        class="w-full px-4 py-3 bg-white border border-[#C4977D]/30 rounded-xl text-[#4A4039]"
                    >
                    <p class="mt-2 text-xs text-[#6B5B4F]/70">Your API key is stored locally and never sent anywhere except Groq's API.</p>
                </div>
                <div class="flex items-center gap-3">
                    <input type="checkbox" id="enableAiToggle" class="w-4 h-4 accent-[#9CAF88]" checked>
                    <label for="enableAiToggle" class="text-sm text-[#4A4039]">Enable AI-powered metadata organization</label>
                </div>
                <button 
                    onclick="saveApiKey()"
                    class="w-full px-5 py-3 bg-[#C4977D] hover:bg-[#B38A70] text-white rounded-xl transition-colors font-medium"
                >
                    Save Settings
                </button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div id="recipeModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0 bg-[#4A4039]/50" onclick="closeModal()"></div>
        <div class="absolute inset-4 md:inset-10 lg:inset-20 bg-[#FFFEFB] rounded-2xl shadow-2xl overflow-hidden flex flex-col">
            <!-- Modal Header -->
            <div class="flex items-center justify-between px-6 py-4 border-b border-[#C4977D]/20">
                <h2 id="modalTitle" class="font-display text-xl font-semibold text-[#4A4039]">Add New Recipe</h2>
                <button onclick="closeModal()" class="p-2 hover:bg-[#F5EDE4] rounded-lg transition-colors">
                    <svg class="w-5 h-5 text-[#6B5B4F]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <!-- Modal Content -->
            <div class="flex-1 overflow-y-auto p-6">
                <div class="max-w-2xl mx-auto space-y-6">
                    <!-- URL Input -->
                    <div id="urlSection">
                        <label class="block text-sm font-medium text-[#4A4039] mb-2">TikTok Video URL</label>
                        <div class="flex gap-3">
                            <input 
                                type="url" 
                                id="tiktokUrl"
                                placeholder="https://www.tiktok.com/@username/video/..."
                                class="flex-1 px-4 py-3 bg-white border border-[#C4977D]/30 rounded-xl text-[#4A4039]"
                            >
                            <button 
                                onclick="fetchMetadata()"
                                id="fetchBtn"
                                class="px-5 py-3 bg-[#9CAF88] hover:bg-[#8A9E79] text-white rounded-xl transition-colors font-medium flex items-center gap-2"
                            >
                                <span id="fetchBtnText">Fetch</span>
                                <div id="fetchSpinner" class="loading-spinner hidden"></div>
                            </button>
                        </div>
                        <p class="mt-2 text-sm text-[#6B5B4F]/70 flex items-center gap-2">
                            <span>Paste your TikTok recipe video URL and click Fetch to auto-fill details</span>
                            <span id="aiStatusBadge" class="hidden px-2 py-0.5 bg-[#9CAF88]/20 text-[#6B5B4F] rounded-full text-xs font-medium">âœ¨ AI Enhanced</span>
                        </p>
                    </div>
                    
                    <!-- Preview & Edit Section -->
                    <div id="editSection" class="hidden space-y-6">
                        <!-- Thumbnail Preview -->
                        <div class="flex gap-6">
                            <div class="w-40 h-56 rounded-xl overflow-hidden bg-[#F5EDE4] flex-shrink-0">
                                <img id="previewThumbnail" src="" alt="" class="w-full h-full object-cover hidden">
                                <div id="thumbnailPlaceholder" class="w-full h-full thumbnail-placeholder flex items-center justify-center">
                                    <svg class="w-12 h-12 text-[#C4977D]/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                    </svg>
                                </div>
                            </div>
                            
                            <div class="flex-1 space-y-4">
                                <!-- Title -->
                                <div>
                                    <label class="block text-sm font-medium text-[#4A4039] mb-2">Recipe Title</label>
                                    <input 
                                        type="text" 
                                        id="recipeTitle"
                                        placeholder="Give your recipe a memorable name..."
                                        class="w-full px-4 py-3 bg-white border border-[#C4977D]/30 rounded-xl text-[#4A4039]"
                                    >
                                </div>
                                
                                <!-- Author -->
                                <div>
                                    <label class="block text-sm font-medium text-[#4A4039] mb-2">Creator</label>
                                    <input 
                                        type="text" 
                                        id="recipeAuthor"
                                        placeholder="TikTok creator name"
                                        class="w-full px-4 py-3 bg-white border border-[#C4977D]/30 rounded-xl text-[#4A4039]"
                                    >
                                </div>
                            </div>
                        </div>
                        
                        <!-- Description -->
                        <div>
                            <label class="block text-sm font-medium text-[#4A4039] mb-2">Description / Recipe Notes</label>
                            <textarea 
                                id="recipeDescription"
                                rows="4"
                                placeholder="Add any recipe steps, ingredients, or notes from the video caption..."
                                class="w-full px-4 py-3 bg-white border border-[#C4977D]/30 rounded-xl text-[#4A4039] resize-none"
                            ></textarea>
                        </div>
                        
                        <!-- Plan to Cook Date -->
                        <div>
                            <label class="block text-sm font-medium text-[#4A4039] mb-2">
                                Plan to Cook 
                                <span class="font-normal text-[#6B5B4F]/70">(optional)</span>
                            </label>
                            <div class="flex gap-3 items-center">
                                <input 
                                    type="date" 
                                    id="recipePlannedDate"
                                    class="flex-1 px-4 py-3 bg-white border border-[#C4977D]/30 rounded-xl text-[#4A4039]"
                                >
                                <button 
                                    onclick="clearPlannedDate()"
                                    class="px-4 py-3 bg-[#F5EDE4] hover:bg-[#E8DDD2] text-[#6B5B4F] rounded-xl transition-colors text-sm"
                                >
                                    Clear
                                </button>
                            </div>
                            <p class="mt-2 text-xs text-[#6B5B4F]/70">Set a date when you plan to cook this recipe</p>
                        </div>
                        
                        <!-- Tags -->
                        <div>
                            <label class="block text-sm font-medium text-[#4A4039] mb-2">Tags</label>
                            <div id="selectedTags" class="flex flex-wrap gap-2 mb-3">
                                <!-- Selected tags will appear here -->
                            </div>
                            <div class="flex gap-2">
                                <input 
                                    type="text" 
                                    id="tagInput"
                                    placeholder="Add a tag (e.g., japanese, dinner, quick)"
                                    class="flex-1 px-4 py-2.5 bg-white border border-[#C4977D]/30 rounded-xl text-[#4A4039]"
                                    onkeypress="handleTagKeypress(event)"
                                >
                                <button 
                                    onclick="addTag()"
                                    class="px-4 py-2.5 bg-[#F5EDE4] hover:bg-[#E8DDD2] text-[#6B5B4F] rounded-xl transition-colors font-medium"
                                >
                                    Add Tag
                                </button>
                            </div>
                            <div class="mt-3">
                                <p class="text-xs text-[#6B5B4F]/70 mb-2">Suggested tags:</p>
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="addSuggestedTag('breakfast')" class="px-3 py-1 text-xs bg-[#F5EDE4] hover:bg-[#E8DDD2] text-[#6B5B4F] rounded-full transition-colors">breakfast</button>
                                    <button onclick="addSuggestedTag('lunch')" class="px-3 py-1 text-xs bg-[#F5EDE4] hover:bg-[#E8DDD2] text-[#6B5B4F] rounded-full transition-colors">lunch</button>
                                    <button onclick="addSuggestedTag('dinner')" class="px-3 py-1 text-xs bg-[#F5EDE4] hover:bg-[#E8DDD2] text-[#6B5B4F] rounded-full transition-colors">dinner</button>
                                    <button onclick="addSuggestedTag('dessert')" class="px-3 py-1 text-xs bg-[#F5EDE4] hover:bg-[#E8DDD2] text-[#6B5B4F] rounded-full transition-colors">dessert</button>
                                    <button onclick="addSuggestedTag('quick')" class="px-3 py-1 text-xs bg-[#F5EDE4] hover:bg-[#E8DDD2] text-[#6B5B4F] rounded-full transition-colors">quick</button>
                                    <button onclick="addSuggestedTag('healthy')" class="px-3 py-1 text-xs bg-[#F5EDE4] hover:bg-[#E8DDD2] text-[#6B5B4F] rounded-full transition-colors">healthy</button>
                                    <button onclick="addSuggestedTag('asian')" class="px-3 py-1 text-xs bg-[#F5EDE4] hover:bg-[#E8DDD2] text-[#6B5B4F] rounded-full transition-colors">asian</button>
                                    <button onclick="addSuggestedTag('western')" class="px-3 py-1 text-xs bg-[#F5EDE4] hover:bg-[#E8DDD2] text-[#6B5B4F] rounded-full transition-colors">western</button>
                                    <button onclick="addSuggestedTag('vegetarian')" class="px-3 py-1 text-xs bg-[#F5EDE4] hover:bg-[#E8DDD2] text-[#6B5B4F] rounded-full transition-colors">vegetarian</button>
                                    <button onclick="addSuggestedTag('noodles')" class="px-3 py-1 text-xs bg-[#F5EDE4] hover:bg-[#E8DDD2] text-[#6B5B4F] rounded-full transition-colors">noodles</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Modal Footer -->
            <div class="flex items-center justify-end gap-3 px-6 py-4 border-t border-[#C4977D]/20 bg-[#FAF6F1]">
                <button 
                    onclick="closeModal()"
                    class="px-5 py-2.5 bg-white border border-[#C4977D]/30 text-[#6B5B4F] rounded-xl hover:bg-[#F5EDE4] transition-colors font-medium"
                >
                    Cancel
                </button>
                <button 
                    onclick="saveRecipe()"
                    id="saveBtn"
                    class="px-5 py-2.5 bg-[#C4977D] hover:bg-[#B38A70] text-white rounded-xl transition-colors font-medium hidden"
                >
                    Save Recipe
                </button>
            </div>
        </div>
    </div>

    <!-- View Recipe Modal -->
    <div id="viewModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0 bg-[#4A4039]/50" onclick="closeViewModal()"></div>
        <div class="absolute inset-4 md:inset-10 lg:inset-y-10 lg:left-1/4 lg:right-1/4 bg-[#FFFEFB] rounded-2xl shadow-2xl overflow-hidden flex flex-col">
            <div class="flex items-center justify-between px-6 py-4 border-b border-[#C4977D]/20">
                <h2 class="font-display text-xl font-semibold text-[#4A4039]">Recipe Details</h2>
                <button onclick="closeViewModal()" class="p-2 hover:bg-[#F5EDE4] rounded-lg transition-colors">
                    <svg class="w-5 h-5 text-[#6B5B4F]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div id="viewModalContent" class="flex-1 overflow-y-auto p-6">
                <!-- Content will be dynamically inserted -->
            </div>
            <div class="flex items-center justify-between gap-3 px-6 py-4 border-t border-[#C4977D]/20 bg-[#FAF6F1]">
                <button 
                    onclick="deleteCurrentRecipe()"
                    class="px-5 py-2.5 bg-red-50 border border-red-200 text-red-600 rounded-xl hover:bg-red-100 transition-colors font-medium"
                >
                    Delete
                </button>
                <div class="flex gap-3">
                    <button 
                        onclick="editCurrentRecipe()"
                        class="px-5 py-2.5 bg-white border border-[#C4977D]/30 text-[#6B5B4F] rounded-xl hover:bg-[#F5EDE4] transition-colors font-medium"
                    >
                        Edit
                    </button>
                    <a 
                        id="openTiktokBtn"
                        href="#"
                        target="_blank"
                        class="px-5 py-2.5 bg-[#C4977D] hover:bg-[#B38A70] text-white rounded-xl transition-colors font-medium inline-flex items-center gap-2"
                    >
                        Open in TikTok
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State
        let recipes = JSON.parse(localStorage.getItem('tiktokRecipes')) || [];
        let currentTags = [];
        let editingRecipeId = null;
        let currentViewRecipeId = null;
        let currentFilter = null;
        let searchQuery = '';
        let currentView = 'gallery'; // 'gallery' or 'timeline'
        
        // AI Settings
        let groqApiKey = localStorage.getItem('groqApiKey') || '';
        let aiEnabled = localStorage.getItem('aiEnabled') !== 'false';

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderRecipes();
            renderTagFilters();
            updateAiIndicator();
            updateUpcomingCount();
            
            document.getElementById('searchInput').addEventListener('input', (e) => {
                searchQuery = e.target.value.toLowerCase();
                renderRecipes();
                if (currentView === 'timeline') {
                    renderTimeline();
                }
            });
        });
        
        // View Toggle Functions
        function setView(view) {
            currentView = view;
            const galleryBtn = document.getElementById('galleryViewBtn');
            const timelineBtn = document.getElementById('timelineViewBtn');
            const galleryView = document.getElementById('galleryView');
            const timelineView = document.getElementById('timelineView');
            const tagFilterSection = document.getElementById('tagFilterSection');
            
            if (view === 'gallery') {
                galleryBtn.classList.add('bg-white', 'text-[#4A4039]', 'shadow-sm');
                galleryBtn.classList.remove('text-[#6B5B4F]', 'hover:bg-white/50');
                timelineBtn.classList.remove('bg-white', 'text-[#4A4039]', 'shadow-sm');
                timelineBtn.classList.add('text-[#6B5B4F]', 'hover:bg-white/50');
                
                galleryView.classList.remove('hidden');
                timelineView.classList.add('hidden');
                tagFilterSection.classList.remove('hidden');
                
                renderRecipes();
            } else {
                timelineBtn.classList.add('bg-white', 'text-[#4A4039]', 'shadow-sm');
                timelineBtn.classList.remove('text-[#6B5B4F]', 'hover:bg-white/50');
                galleryBtn.classList.remove('bg-white', 'text-[#4A4039]', 'shadow-sm');
                galleryBtn.classList.add('text-[#6B5B4F]', 'hover:bg-white/50');
                
                timelineView.classList.remove('hidden');
                galleryView.classList.add('hidden');
                tagFilterSection.classList.add('hidden');
                
                renderTimeline();
            }
        }
        
        function updateUpcomingCount() {
            const today = new Date().toISOString().split('T')[0];
            const upcomingRecipes = recipes.filter(r => r.plannedDate && r.plannedDate >= today);
            const countEl = document.getElementById('upcomingCount');
            
            if (upcomingRecipes.length > 0) {
                countEl.textContent = upcomingRecipes.length;
                countEl.classList.remove('hidden');
            } else {
                countEl.classList.add('hidden');
            }
        }
        
        function renderTimeline() {
            const container = document.getElementById('timelineContent');
            const noPlannedState = document.getElementById('noPlannedState');
            const today = new Date().toISOString().split('T')[0];
            
            // Get recipes with planned dates, sorted by date
            let plannedRecipes = recipes
                .filter(r => r.plannedDate)
                .filter(r => {
                    if (!searchQuery) return true;
                    return r.title.toLowerCase().includes(searchQuery) ||
                           r.description.toLowerCase().includes(searchQuery) ||
                           r.author.toLowerCase().includes(searchQuery) ||
                           r.tags.some(tag => tag.includes(searchQuery));
                })
                .sort((a, b) => a.plannedDate.localeCompare(b.plannedDate));
            
            if (plannedRecipes.length === 0) {
                container.innerHTML = '';
                noPlannedState.classList.remove('hidden');
                return;
            }
            
            noPlannedState.classList.add('hidden');
            
            // Group by date category
            const todayRecipes = plannedRecipes.filter(r => r.plannedDate === today);
            const upcomingRecipes = plannedRecipes.filter(r => r.plannedDate > today);
            const pastRecipes = plannedRecipes.filter(r => r.plannedDate < today).reverse();
            
            // Group upcoming by relative time
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];
            
            const thisWeekEnd = new Date();
            thisWeekEnd.setDate(thisWeekEnd.getDate() + 7);
            const thisWeekEndStr = thisWeekEnd.toISOString().split('T')[0];
            
            const tomorrowRecipes = upcomingRecipes.filter(r => r.plannedDate === tomorrowStr);
            const thisWeekRecipes = upcomingRecipes.filter(r => r.plannedDate > tomorrowStr && r.plannedDate <= thisWeekEndStr);
            const laterRecipes = upcomingRecipes.filter(r => r.plannedDate > thisWeekEndStr);
            
            let html = '';
            
            // Today Section
            if (todayRecipes.length > 0) {
                html += renderTimelineSection('ðŸ³ Today', todayRecipes, 'today');
            }
            
            // Tomorrow Section
            if (tomorrowRecipes.length > 0) {
                html += renderTimelineSection('Tomorrow', tomorrowRecipes, 'upcoming');
            }
            
            // This Week Section
            if (thisWeekRecipes.length > 0) {
                html += renderTimelineSection('This Week', thisWeekRecipes, 'upcoming');
            }
            
            // Later Section
            if (laterRecipes.length > 0) {
                html += renderTimelineSection('Coming Up', laterRecipes, 'upcoming');
            }
            
            // Past Section (collapsed by default)
            if (pastRecipes.length > 0) {
                html += `
                    <div class="mt-8">
                        <button 
                            onclick="togglePastRecipes()"
                            class="flex items-center gap-2 text-[#6B5B4F]/70 hover:text-[#6B5B4F] transition-colors mb-4"
                        >
                            <svg id="pastChevron" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                            <span class="text-sm font-medium">Past Recipes (${pastRecipes.length})</span>
                        </button>
                        <div id="pastRecipesSection" class="hidden">
                            ${renderTimelineCards(pastRecipes, 'past')}
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        function renderTimelineSection(title, recipes, type) {
            const bgColor = type === 'today' ? 'bg-[#C4977D]' : 'bg-[#9CAF88]';
            const textColor = type === 'today' ? 'text-[#8B5A3C]' : 'text-[#5A6B4D]';
            
            return `
                <div class="mb-8">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-3 h-3 ${bgColor} rounded-full"></div>
                        <h3 class="font-display text-lg font-semibold ${type === 'today' ? 'text-[#C4977D]' : 'text-[#4A4039]'}">${title}</h3>
                        <span class="text-sm text-[#6B5B4F]/50">${recipes.length} recipe${recipes.length > 1 ? 's' : ''}</span>
                    </div>
                    <div class="ml-1.5 pl-5 border-l-2 ${type === 'today' ? 'border-[#C4977D]/30' : 'border-[#9CAF88]/30'}">
                        ${renderTimelineCards(recipes, type)}
                    </div>
                </div>
            `;
        }
        
        function renderTimelineCards(recipes, type) {
            return recipes.map(recipe => {
                const formattedDate = formatPlannedDateFull(recipe.plannedDate);
                const cardBg = type === 'today' ? 'bg-[#C4977D]/10 border-[#C4977D]/20' : 
                               type === 'past' ? 'bg-gray-50 border-gray-200' : 
                               'bg-white border-[#C4977D]/10';
                
                return `
                    <div class="mb-4 last:mb-0">
                        <div 
                            class="recipe-card ${cardBg} border rounded-xl p-4 cursor-pointer flex gap-4"
                            onclick="viewRecipe('${recipe.id}')"
                        >
                            <div class="w-16 h-20 rounded-lg overflow-hidden bg-[#F5EDE4] flex-shrink-0">
                                ${recipe.thumbnail ? 
                                    `<img src="${recipe.thumbnail}" alt="${recipe.title}" class="w-full h-full object-cover">` :
                                    `<div class="w-full h-full flex items-center justify-center">
                                        <svg class="w-6 h-6 text-[#C4977D]/30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                        </svg>
                                    </div>`
                                }
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-start justify-between gap-2">
                                    <h4 class="font-display font-semibold text-[#4A4039] line-clamp-1">${recipe.title}</h4>
                                    <span class="text-xs text-[#6B5B4F]/60 whitespace-nowrap">${formattedDate}</span>
                                </div>
                                ${recipe.author ? `<p class="text-sm text-[#6B5B4F]/70">by ${recipe.author}</p>` : ''}
                                ${recipe.tags.length > 0 ? `
                                    <div class="flex flex-wrap gap-1 mt-2">
                                        ${recipe.tags.slice(0, 3).map(tag => `
                                            <span class="px-2 py-0.5 bg-[#9CAF88]/20 text-[#6B5B4F] rounded-full text-xs">${tag}</span>
                                        `).join('')}
                                    </div>
                                ` : ''}
                            </div>
                            <div class="flex items-center">
                                <svg class="w-5 h-5 text-[#C4977D]/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function togglePastRecipes() {
            const section = document.getElementById('pastRecipesSection');
            const chevron = document.getElementById('pastChevron');
            
            if (section.classList.contains('hidden')) {
                section.classList.remove('hidden');
                chevron.style.transform = 'rotate(90deg)';
            } else {
                section.classList.add('hidden');
                chevron.style.transform = 'rotate(0deg)';
            }
        }
        
        function formatPlannedDateFull(dateString) {
            const date = new Date(dateString + 'T00:00:00');
            const options = { weekday: 'short', month: 'short', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }
        
        // API Key Modal Functions
        function openApiKeyModal() {
            document.getElementById('groqApiKeyInput').value = groqApiKey;
            document.getElementById('enableAiToggle').checked = aiEnabled;
            document.getElementById('apiKeyModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        function closeApiKeyModal() {
            document.getElementById('apiKeyModal').classList.add('hidden');
            document.body.style.overflow = '';
        }
        
        function saveApiKey() {
            groqApiKey = document.getElementById('groqApiKeyInput').value.trim();
            aiEnabled = document.getElementById('enableAiToggle').checked;
            
            localStorage.setItem('groqApiKey', groqApiKey);
            localStorage.setItem('aiEnabled', aiEnabled);
            
            updateAiIndicator();
            closeApiKeyModal();
        }
        
        function updateAiIndicator() {
            const indicator = document.getElementById('aiIndicator');
            const badge = document.getElementById('aiStatusBadge');
            
            if (groqApiKey && aiEnabled) {
                indicator.classList.remove('bg-gray-300');
                indicator.classList.add('bg-[#9CAF88]');
                badge.classList.remove('hidden');
            } else {
                indicator.classList.remove('bg-[#9CAF88]');
                indicator.classList.add('bg-gray-300');
                badge.classList.add('hidden');
            }
        }
        
        // AI Processing with Groq
        async function processWithAI(rawMetadata) {
            if (!groqApiKey || !aiEnabled) {
                return null;
            }
            
            try {
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${groqApiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'llama-3.1-8b-instant',
                        messages: [
                            {
                                role: 'system',
                                content: `You are a helpful assistant that organizes TikTok recipe video metadata. Given raw metadata from a TikTok video, extract and organize the information into a clean, structured format.

Your task:
1. Create a clear, concise recipe TITLE (remove hashtags, emojis, and unnecessary text - just the recipe name)
2. Extract the DESCRIPTION which should include any recipe steps, ingredients, or cooking notes mentioned (clean up the text, make it readable)
3. Suggest relevant TAGS for categorization (cuisine type, meal type, main ingredients, cooking style - lowercase, single words or short phrases)

Respond ONLY with valid JSON in this exact format:
{
  "title": "Clean recipe title here",
  "description": "Organized recipe notes, ingredients, or steps here",
  "suggestedTags": ["tag1", "tag2", "tag3"]
}`
                            },
                            {
                                role: 'user',
                                content: `Please organize this TikTok recipe metadata:\n\nTitle/Caption: ${rawMetadata.title}\nCreator: ${rawMetadata.author_name || 'Unknown'}`
                            }
                        ],
                        temperature: 0.3,
                        max_tokens: 500
                    })
                });
                
                if (!response.ok) {
                    throw new Error('AI request failed');
                }
                
                const data = await response.json();
                const content = data.choices[0]?.message?.content;
                
                if (content) {
                    // Parse the JSON response
                    const jsonMatch = content.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        return JSON.parse(jsonMatch[0]);
                    }
                }
                
                return null;
            } catch (error) {
                console.error('AI processing error:', error);
                return null;
            }
        }

        // Modal Functions
        function openAddModal() {
            editingRecipeId = null;
            currentTags = [];
            document.getElementById('modalTitle').textContent = 'Add New Recipe';
            document.getElementById('tiktokUrl').value = '';
            document.getElementById('urlSection').classList.remove('hidden');
            document.getElementById('editSection').classList.add('hidden');
            document.getElementById('saveBtn').classList.add('hidden');
            document.getElementById('recipeModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('recipeModal').classList.add('hidden');
            document.body.style.overflow = '';
            resetModalForm();
        }

        function resetModalForm() {
            document.getElementById('tiktokUrl').value = '';
            document.getElementById('recipeTitle').value = '';
            document.getElementById('recipeAuthor').value = '';
            document.getElementById('recipeDescription').value = '';
            document.getElementById('recipePlannedDate').value = '';
            document.getElementById('previewThumbnail').src = '';
            document.getElementById('previewThumbnail').classList.add('hidden');
            document.getElementById('thumbnailPlaceholder').classList.remove('hidden');
            currentTags = [];
            renderSelectedTags();
        }
        
        function clearPlannedDate() {
            document.getElementById('recipePlannedDate').value = '';
        }

        // Fetch with timeout helper
        async function fetchWithTimeout(url, options = {}, timeout = 10000) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);
            
            try {
                const response = await fetch(url, {
                    ...options,
                    signal: controller.signal
                });
                clearTimeout(timeoutId);
                return response;
            } catch (error) {
                clearTimeout(timeoutId);
                throw error;
            }
        }
        
        // Try multiple CORS proxies
        async function fetchWithProxy(targetUrl) {
            const proxies = [
                (url) => `https://corsproxy.io/?${encodeURIComponent(url)}`,
                (url) => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
                (url) => `https://proxy.cors.sh/${url}`
            ];
            
            for (const proxyFn of proxies) {
                try {
                    const proxyUrl = proxyFn(targetUrl);
                    const response = await fetchWithTimeout(proxyUrl, {}, 8000);
                    
                    if (response.ok) {
                        const text = await response.text();
                        return JSON.parse(text);
                    }
                } catch (error) {
                    console.log('Proxy failed, trying next...', error.message);
                    continue;
                }
            }
            
            throw new Error('All proxies failed');
        }

        // Fetch Metadata
        async function fetchMetadata() {
            const url = document.getElementById('tiktokUrl').value.trim();
            if (!url) {
                alert('Please enter a TikTok URL');
                return;
            }

            // Show loading
            const fetchBtn = document.getElementById('fetchBtn');
            const fetchBtnText = document.getElementById('fetchBtnText');
            const spinner = document.getElementById('fetchSpinner');
            fetchBtn.disabled = true;
            spinner.classList.remove('hidden');
            fetchBtnText.textContent = 'Fetching...';

            try {
                // Fetch TikTok oEmbed data through proxy
                const oembedUrl = `https://www.tiktok.com/oembed?url=${encodeURIComponent(url)}`;
                const oembedData = await fetchWithProxy(oembedUrl);
                
                if (oembedData) {
                    // Set thumbnail first
                    if (oembedData.thumbnail_url) {
                        document.getElementById('previewThumbnail').src = oembedData.thumbnail_url;
                        document.getElementById('previewThumbnail').classList.remove('hidden');
                        document.getElementById('thumbnailPlaceholder').classList.add('hidden');
                    }
                    
                    // Set author
                    document.getElementById('recipeAuthor').value = oembedData.author_name || '';
                    
                    // Try AI processing if enabled
                    if (groqApiKey && aiEnabled) {
                        fetchBtnText.textContent = 'AI Processing...';
                        
                        const aiResult = await processWithAI(oembedData);
                        
                        if (aiResult) {
                            // Use AI-organized data
                            document.getElementById('recipeTitle').value = aiResult.title || oembedData.title || '';
                            document.getElementById('recipeDescription').value = aiResult.description || '';
                            
                            // Add AI-suggested tags
                            if (aiResult.suggestedTags && Array.isArray(aiResult.suggestedTags)) {
                                currentTags = [...new Set([...currentTags, ...aiResult.suggestedTags.slice(0, 5)])];
                                renderSelectedTags();
                            }
                        } else {
                            // Fallback to raw data
                            document.getElementById('recipeTitle').value = oembedData.title || '';
                            document.getElementById('recipeDescription').value = oembedData.title || '';
                            autoSuggestTags(oembedData.title || '');
                        }
                    } else {
                        // No AI - use raw data
                        document.getElementById('recipeTitle').value = oembedData.title || '';
                        document.getElementById('recipeDescription').value = oembedData.title || '';
                        autoSuggestTags(oembedData.title || '');
                    }
                }
                
                showEditSection();
                
            } catch (error) {
                console.error('Error fetching metadata:', error);
                // Still show edit section but with empty fields
                showEditSection();
                alert('Could not fetch video details automatically. You can still add the recipe manually.');
            } finally {
                fetchBtn.disabled = false;
                spinner.classList.add('hidden');
                fetchBtnText.textContent = 'Fetch';
            }
        }

        function autoSuggestTags(title) {
            const titleLower = title.toLowerCase();
            const suggestedTags = [];
            
            const tagKeywords = {
                'japanese': ['japanese', 'japan', 'sushi', 'ramen', 'miso', 'teriyaki', 'tempura'],
                'korean': ['korean', 'korea', 'kimchi', 'bibimbap', 'gochujang'],
                'chinese': ['chinese', 'china', 'wok', 'stir fry', 'dim sum'],
                'asian': ['asian', 'rice', 'noodle', 'soy sauce'],
                'italian': ['italian', 'italy', 'pasta', 'pizza', 'risotto'],
                'mexican': ['mexican', 'mexico', 'taco', 'burrito', 'salsa'],
                'breakfast': ['breakfast', 'morning', 'eggs', 'pancake', 'waffle'],
                'lunch': ['lunch', 'sandwich', 'salad'],
                'dinner': ['dinner', 'supper'],
                'dessert': ['dessert', 'sweet', 'cake', 'cookie', 'chocolate'],
                'healthy': ['healthy', 'salad', 'vegetable', 'low cal'],
                'quick': ['quick', 'easy', 'minute', 'fast', 'simple'],
                'noodles': ['noodle', 'pasta', 'ramen', 'udon', 'spaghetti'],
                'vegetarian': ['vegetarian', 'vegan', 'veggie', 'plant based'],
                'chicken': ['chicken'],
                'beef': ['beef', 'steak'],
                'seafood': ['fish', 'shrimp', 'salmon', 'seafood']
            };
            
            for (const [tag, keywords] of Object.entries(tagKeywords)) {
                if (keywords.some(keyword => titleLower.includes(keyword))) {
                    if (!currentTags.includes(tag)) {
                        currentTags.push(tag);
                    }
                }
            }
            
            renderSelectedTags();
        }

        function showEditSection() {
            document.getElementById('editSection').classList.remove('hidden');
            document.getElementById('saveBtn').classList.remove('hidden');
        }

        // Tag Functions
        function addTag() {
            const tagInput = document.getElementById('tagInput');
            const tag = tagInput.value.trim().toLowerCase();
            
            if (tag && !currentTags.includes(tag)) {
                currentTags.push(tag);
                renderSelectedTags();
                tagInput.value = '';
            }
        }

        function addSuggestedTag(tag) {
            if (!currentTags.includes(tag)) {
                currentTags.push(tag);
                renderSelectedTags();
            }
        }

        function removeTag(tag) {
            currentTags = currentTags.filter(t => t !== tag);
            renderSelectedTags();
        }

        function handleTagKeypress(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                addTag();
            }
        }

        function renderSelectedTags() {
            const container = document.getElementById('selectedTags');
            container.innerHTML = currentTags.map(tag => `
                <span class="inline-flex items-center gap-1 px-3 py-1.5 bg-[#9CAF88] text-white rounded-full text-sm">
                    ${tag}
                    <button onclick="removeTag('${tag}')" class="hover:bg-white/20 rounded-full p-0.5">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </span>
            `).join('');
        }

        // Save Recipe
        function saveRecipe() {
            const title = document.getElementById('recipeTitle').value.trim();
            const url = document.getElementById('tiktokUrl').value.trim();
            
            if (!title) {
                alert('Please enter a recipe title');
                return;
            }
            
            if (!url) {
                alert('Please enter a TikTok URL');
                return;
            }

            const recipe = {
                id: editingRecipeId || Date.now().toString(),
                url: url,
                title: title,
                author: document.getElementById('recipeAuthor').value.trim(),
                description: document.getElementById('recipeDescription').value.trim(),
                thumbnail: document.getElementById('previewThumbnail').src || '',
                tags: [...currentTags],
                plannedDate: document.getElementById('recipePlannedDate').value || null,
                createdAt: editingRecipeId ? recipes.find(r => r.id === editingRecipeId)?.createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            if (editingRecipeId) {
                const index = recipes.findIndex(r => r.id === editingRecipeId);
                if (index !== -1) {
                    recipes[index] = recipe;
                }
            } else {
                recipes.unshift(recipe);
            }

            saveToLocalStorage();
            renderRecipes();
            renderTagFilters();
            updateUpcomingCount();
            if (currentView === 'timeline') {
                renderTimeline();
            }
            closeModal();
        }

        // Delete Recipe
        function deleteRecipe(id) {
            if (confirm('Are you sure you want to delete this recipe?')) {
                recipes = recipes.filter(r => r.id !== id);
                saveToLocalStorage();
                renderRecipes();
                renderTagFilters();
                updateUpcomingCount();
                if (currentView === 'timeline') {
                    renderTimeline();
                }
            }
        }

        function deleteCurrentRecipe() {
            if (currentViewRecipeId) {
                deleteRecipe(currentViewRecipeId);
                closeViewModal();
            }
        }

        // Edit Recipe
        function editRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;

            editingRecipeId = id;
            currentTags = [...recipe.tags];
            
            document.getElementById('modalTitle').textContent = 'Edit Recipe';
            document.getElementById('tiktokUrl').value = recipe.url;
            document.getElementById('recipeTitle').value = recipe.title;
            document.getElementById('recipeAuthor').value = recipe.author;
            document.getElementById('recipeDescription').value = recipe.description;
            document.getElementById('recipePlannedDate').value = recipe.plannedDate || '';
            
            if (recipe.thumbnail) {
                document.getElementById('previewThumbnail').src = recipe.thumbnail;
                document.getElementById('previewThumbnail').classList.remove('hidden');
                document.getElementById('thumbnailPlaceholder').classList.add('hidden');
            }
            
            renderSelectedTags();
            showEditSection();
            document.getElementById('recipeModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function editCurrentRecipe() {
            if (currentViewRecipeId) {
                closeViewModal();
                editRecipe(currentViewRecipeId);
            }
        }

        // View Recipe
        function viewRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;

            currentViewRecipeId = id;
            document.getElementById('openTiktokBtn').href = recipe.url;
            
            const content = document.getElementById('viewModalContent');
            const formattedDate = recipe.plannedDate ? formatPlannedDate(recipe.plannedDate) : null;
            const isUpcoming = recipe.plannedDate ? isDateUpcoming(recipe.plannedDate) : false;
            const isToday = recipe.plannedDate ? isDateToday(recipe.plannedDate) : false;
            const isPast = recipe.plannedDate ? isDatePast(recipe.plannedDate) : false;
            
            content.innerHTML = `
                <div class="max-w-lg mx-auto">
                    ${recipe.thumbnail ? `
                        <div class="w-full aspect-[9/16] max-h-80 rounded-xl overflow-hidden mb-6 bg-[#F5EDE4]">
                            <img src="${recipe.thumbnail}" alt="${recipe.title}" class="w-full h-full object-cover">
                        </div>
                    ` : ''}
                    
                    <h3 class="font-display text-2xl font-semibold text-[#4A4039] mb-2">${recipe.title}</h3>
                    
                    ${recipe.author ? `
                        <p class="text-[#6B5B4F] mb-4 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                            ${recipe.author}
                        </p>
                    ` : ''}
                    
                    ${formattedDate ? `
                        <div class="mb-4 inline-flex items-center gap-2 px-3 py-2 rounded-lg ${isToday ? 'bg-[#C4977D]/20 text-[#8B5A3C]' : isPast ? 'bg-gray-100 text-gray-500' : 'bg-[#9CAF88]/20 text-[#5A6B4D]'}">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <span class="text-sm font-medium">
                                ${isToday ? 'ðŸ³ Cooking Today!' : isPast ? 'Was planned for ' + formattedDate : 'Planned for ' + formattedDate}
                            </span>
                        </div>
                    ` : ''}
                    
                    ${recipe.tags.length > 0 ? `
                        <div class="flex flex-wrap gap-2 mb-6">
                            ${recipe.tags.map(tag => `
                                <span class="px-3 py-1 bg-[#9CAF88]/20 text-[#6B5B4F] rounded-full text-sm">${tag}</span>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    ${recipe.description ? `
                        <div class="bg-[#F5EDE4] rounded-xl p-4">
                            <h4 class="font-medium text-[#4A4039] mb-2">Notes & Description</h4>
                            <p class="text-[#6B5B4F] whitespace-pre-wrap">${recipe.description}</p>
                        </div>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('viewModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeViewModal() {
            document.getElementById('viewModal').classList.add('hidden');
            document.body.style.overflow = '';
            currentViewRecipeId = null;
        }

        // Filter Functions
        function filterByTag(tag) {
            currentFilter = tag;
            
            // Update active state
            document.querySelectorAll('.tag-chip').forEach(btn => {
                btn.classList.remove('bg-[#9CAF88]', 'text-white');
                btn.classList.add('bg-[#F5EDE4]', 'text-[#6B5B4F]');
            });
            
            if (tag === null) {
                document.getElementById('allTagsBtn').classList.remove('bg-[#F5EDE4]', 'text-[#6B5B4F]');
                document.getElementById('allTagsBtn').classList.add('bg-[#9CAF88]', 'text-white');
            } else {
                const activeBtn = document.querySelector(`[data-tag="${tag}"]`);
                if (activeBtn) {
                    activeBtn.classList.remove('bg-[#F5EDE4]', 'text-[#6B5B4F]');
                    activeBtn.classList.add('bg-[#9CAF88]', 'text-white');
                }
            }
            
            renderRecipes();
        }

        // Render Functions
        function renderRecipes() {
            const gallery = document.getElementById('recipeGallery');
            const emptyState = document.getElementById('emptyState');
            const noResultsState = document.getElementById('noResultsState');
            
            // Filter recipes
            let filteredRecipes = recipes.filter(recipe => {
                const matchesTag = !currentFilter || recipe.tags.includes(currentFilter);
                const matchesSearch = !searchQuery || 
                    recipe.title.toLowerCase().includes(searchQuery) ||
                    recipe.description.toLowerCase().includes(searchQuery) ||
                    recipe.author.toLowerCase().includes(searchQuery) ||
                    recipe.tags.some(tag => tag.includes(searchQuery));
                return matchesTag && matchesSearch;
            });

            if (recipes.length === 0) {
                gallery.innerHTML = '';
                emptyState.classList.remove('hidden');
                noResultsState.classList.add('hidden');
                return;
            }

            if (filteredRecipes.length === 0) {
                gallery.innerHTML = '';
                emptyState.classList.add('hidden');
                noResultsState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            noResultsState.classList.add('hidden');
            
            gallery.innerHTML = filteredRecipes.map(recipe => {
                const hasPlannedDate = recipe.plannedDate;
                const isToday = hasPlannedDate ? isDateToday(recipe.plannedDate) : false;
                const isPast = hasPlannedDate ? isDatePast(recipe.plannedDate) : false;
                const formattedDate = hasPlannedDate ? formatPlannedDate(recipe.plannedDate) : null;
                
                return `
                <div class="recipe-card bg-white rounded-2xl overflow-hidden shadow-sm border border-[#C4977D]/10 cursor-pointer ${isToday ? 'ring-2 ring-[#C4977D]' : ''}" onclick="viewRecipe('${recipe.id}')">
                    <div class="aspect-[9/12] bg-[#F5EDE4] relative overflow-hidden">
                        ${recipe.thumbnail ? 
                            `<img src="${recipe.thumbnail}" alt="${recipe.title}" class="w-full h-full object-cover">` :
                            `<div class="w-full h-full flex items-center justify-center">
                                <svg class="w-16 h-16 text-[#C4977D]/30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                            </div>`
                        }
                        <div class="absolute top-2 right-2">
                            <button 
                                onclick="event.stopPropagation(); editRecipe('${recipe.id}')"
                                class="p-2 bg-white/90 hover:bg-white rounded-lg shadow-sm transition-colors"
                            >
                                <svg class="w-4 h-4 text-[#6B5B4F]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                </svg>
                            </button>
                        </div>
                        ${hasPlannedDate ? `
                            <div class="absolute bottom-2 left-2 right-2">
                                <div class="inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs font-medium ${isToday ? 'bg-[#C4977D] text-white' : isPast ? 'bg-gray-500/80 text-white' : 'bg-white/95 text-[#6B5B4F]'}">
                                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                    ${isToday ? 'ðŸ³ Today!' : formattedDate}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    <div class="p-4">
                        <h3 class="font-display font-semibold text-[#4A4039] mb-1 line-clamp-2">${recipe.title}</h3>
                        ${recipe.author ? `<p class="text-sm text-[#6B5B4F]/70 mb-3">by ${recipe.author}</p>` : '<div class="mb-3"></div>'}
                        ${recipe.tags.length > 0 ? `
                            <div class="flex flex-wrap gap-1.5">
                                ${recipe.tags.slice(0, 3).map(tag => `
                                    <span class="px-2 py-0.5 bg-[#9CAF88]/20 text-[#6B5B4F] rounded-full text-xs">${tag}</span>
                                `).join('')}
                                ${recipe.tags.length > 3 ? `<span class="px-2 py-0.5 text-[#6B5B4F]/50 text-xs">+${recipe.tags.length - 3}</span>` : ''}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `}).join('');
        }

        function renderTagFilters() {
            const container = document.getElementById('tagFilters');
            
            // Get all unique tags from recipes
            const allTags = [...new Set(recipes.flatMap(r => r.tags))].sort();
            
            container.innerHTML = allTags.map(tag => `
                <button 
                    onclick="filterByTag('${tag}')"
                    data-tag="${tag}"
                    class="tag-chip px-3 py-1.5 rounded-full text-sm font-medium ${currentFilter === tag ? 'bg-[#9CAF88] text-white' : 'bg-[#F5EDE4] text-[#6B5B4F] hover:bg-[#E8DDD2]'}"
                >
                    ${tag}
                </button>
            `).join('');
        }

        // Date Helper Functions
        function formatPlannedDate(dateString) {
            const date = new Date(dateString + 'T00:00:00');
            const options = { weekday: 'short', month: 'short', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }
        
        function isDateToday(dateString) {
            const today = new Date().toISOString().split('T')[0];
            return dateString === today;
        }
        
        function isDateUpcoming(dateString) {
            const today = new Date().toISOString().split('T')[0];
            return dateString >= today;
        }
        
        function isDatePast(dateString) {
            const today = new Date().toISOString().split('T')[0];
            return dateString < today;
        }

        // Local Storage
        function saveToLocalStorage() {
            localStorage.setItem('tiktokRecipes', JSON.stringify(recipes));
        }
    </script>
</body>
</html>